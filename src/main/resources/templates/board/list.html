<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}">
<body>
    <th:block layout:fragment="content">
        <style>
            section#board-container {
                margin: 0 auto;
                text-align: center;
            }
            table#tbl-board {
                width: 100%;
                margin: 0 auto;
                border-top: 1px solid black;
                border-collapse: collapse;
                clear: both;
            }
            table#tbl-board th,
            table#tbl-board td {
                border-bottom: 1px solid;
                padding: 10px 0;
                text-align: center;
            }
            div#pageBar {
                padding-top: 50px;
                text-align: center;
            }
            div#pageBar span.cPage {
                color: #1d6403;
            }

            #searchdata {
                border: 1px solid black;
                padding: 10px;
                margin-bottom: 10px;
            }
            #searchbox {
                width: 300px;
                height: 20px;
            }
            #totalsearch {
                float: right;
            }
            .pl {
                width: 120px;
                height: 25px;
            }
            #btn-search {
                background-color: black;
                color: white;
                width: 70px;
            }
            #beforeDate,#currentDate{
                margin-left: 20px;
                margin-right: 20px;
            }
        </style>
        <div style="padding: 20px;">
            <h2 style="padding-bottom: 20px">ÏûêÏú† Í≤åÏãúÌåê - Î™©Î°ù</h2>

<!--            Í≤ÄÏÉâ Í∏∞Îä•-->
            <form name="searchBox-form" id="searchBox-form" autocomplete="off">
                <div id="searchdata">
                    Îì±Î°ùÏùº <input type="date" id="beforeDate" name="beforeDate"/>~<input type="date" id="currentDate" name="currentDate"/>
                    <div id="totalsearch">
                        <select name="cateNo" id="cateNo" class="pl">
                            <option disabled>Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù</option>
                            <th:block th:each="cateList: ${categoryList}">
                                <option th:value="${cateList.cateNo}" th:text="${cateList.cateName}"></option>
                            </th:block>
                        </select>
                        <input type="text" id="searchbox" name="searchbox" placeholder="Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.(Ï†úÎ™©+ÏûëÏÑ±Ïûê+ÎÇ¥Ïö©)"/>
                        <input type="button" onclick="call_ajax()" id="btn-search" value="Í≤ÄÏÉâ" />
                    </div>
                </div>
            </form>

            <script>
                //inputÌÉúÍ∑∏ ÌòÑÏû¨ ÎÇ†Ïßú ÎîîÌè¥Ìä∏Í∞í
                document.getElementById('currentDate').value = new Date().toISOString().substring(0, 10);
                var now = new Date();
                //input ÌÉúÍ∑∏ 1ÎÖÑÏ†ÑÏúºÎ°ú ÏÑ§Ï†ï
                document.getElementById('beforeDate').value = new Date(now.setFullYear(now.getFullYear() - 1)).toISOString().substring(0, 10);

                //Í≤ÄÏÉâÍ∏∞Îä•
                function call_ajax(){
                    if($('#searchbox').val().length === 0){
                        alert("Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî")
                    }else{
                        $.ajax({
                            type: 'GET',
                            url : "/board/searchBoard.do",
                            data : $("#searchBox-form").serialize(),   //ÌèºÌÉúÍ∑∏ ÏïàÏóê Îç∞Ïù¥ÌÑ∞Î•º ÏßÅÎ†¨ÌôîÌï¥ÏÑú Î≥¥ÎÉÑ
                            success : function(result) {
                                //ÌÖåÏù¥Î∏î Ï†ïÎ≥¥ Ï¥àÍ∏∞Ìôî
                                $('#tbl-board > tbody').empty();
                                let str = "";
                                if (result.length > 0) {
                                    var data = JSON.parse(result);      //JSONÏùÑ Í∞ùÏ≤¥Î°ú Î≥ÄÍ≤Ω
                                    for (let i=0;i<data.length;i++) {
                                        str += '<tr>';
                                        str += "<td>" + data[i].cateNo + "</td>";
                                        str += "<td>" + "" + "</td>";
                                        if(data[i].title.length>30){
                                            var title = data[i].title.substring(0,30)+"...";
                                            str += "<td><a href='/board/boardDetail.do?boardNo=" + data[i].boardNo + "'>" + title + "</a></td>";
                                        }else{
                                            str += "<td><a href='/board/boardDetail.do?boardNo=" + data[i].boardNo + "'>" + data[i].title + "</a></td>";
                                        }
                                        str += "<td>" + data[i].writer + "</td>";
                                        str += "<td>" + data[i].boardCount + "</td>";
                                        str += "<td>" + data[i].createDay + "</td>";
                                        if(data[i].updateDay != null){
                                            str += "<td>" + data[i].updateDay + "</td>";
                                        }else{
                                            str += "<td>" + "-" + "</td>";
                                        }
                                        console.log(data[i].updateDay);
                                        str += "</tr>";
                                    }
                                    //Ï¥ù Í≤åÏãúÎ¨º Ïàò
                                    $('#total').html("<p id='total'>Ï¥ù " + data.length + " Í±¥" + "</p>")
                                }else{
                                    str += "<tr><td>Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</td></tr>";
                                    $('#total').html("<p id='total'>Ï¥ù 0 Í±¥</p>")
                                }
                                //ajaxÌéòÏù¥ÏßÄ Ï≤òÎ¶¨Îäî....
                                $('#pageBar').html("<div></div>");
                                $('#tbl-board > tbody').append(str);
                            }
                        })
                    }
                }
            </script>

            <p id="total">Ï¥ù <span th:text="${totalData}"/>Í±¥</p>

            <section id="board-container">
                <table id="tbl-board">
                    <thead>
                    <tr>
                        <th>Ïπ¥ÌÖåÍ≥†Î¶¨</th>
                        <th>ÌååÏùº</th>
                        <th>Ï†úÎ™©</th>
                        <th>ÏûëÏÑ±Ïûê</th>
                        <th>Ï°∞ÌöåÏàò</th>
                        <th>Îì±Î°ùÏùºÏãú</th>
                        <th>ÏàòÏ†ïÏùºÏãú</th>
                    </tr>
                    </thead>
                    <tbody>
                    <th:block th:if="${!boardList.isEmpty()}">
                        <tr id="tableinfo" th:each="board: ${boardList}">
                            <td th:text="${board.category.cateName}"/>
                            <td>
                                <th:block th:each="number:${fileList}">
                                    <th:block th:text="${board.boardNo eq number.boardNo?'üìé':' '}"/>
                                </th:block>
                            </td>
                            <td>
                                <a th:href="@{|/board/boardDetail.do?boardNo=${board.boardNo}|}"
                                   th:text="${board.title.length() >= 30 ? #strings.substring(board.title,0,30)+'...' : board.title}"></a>
                            </td>
                            <td th:text="${board.writer}"/>
                            <td th:text="${board.boardCount}"/>
                            <td th:text="${#dates.format(board.createDay, 'yyyy-MM-dd HH:mm')}"/>
                            <td>
                                <th:block th:if="${board.updateDay != null}">
                                    <th:block th:text="${#dates.format(board.updateDay, 'yyyy-MM-dd HH:mm')}"/>
                                </th:block>
                                <th:block th:if="${board.updateDay == null}">
                                    -
                                </th:block>
                            </td>
                        </tr>
                    </th:block>
                    </tbody>
                </table>

<!--                <div id="pageBar">${pageBar}</div>-->

                <div style="float: right; padding: 50px">
                    <input type="button" onclick="insertbaord();" value="Îì±Î°ù" style="width: 90px" />
                </div>
                <script>
                    const insertbaord=()=>{
                        location.href="/board/write.do";
                    }
                </script>
            </section>
        </div>
    </th:block>
</body>
</html>